<form name="commentForm" ng-submit="s.submitForm(commentForm.$valid)" novalidate>

<div class="modal-header">
	<button type="button" class="btn btn-default close" aria-label="Close" ng-click="s.cancel()">
		<span aria-hidden="true">&times;</span>
	</button>
    <h3 class="modal-title">Public Comment <span ng-if="authentication.user">({{s.comment.commentId}})</span></h3>
</div>
<div class="modal-body">

    <!-- COMMENT NOTE ALERTS -->
    <div class="comment-alert alert {{ s.alertType }}" ng-if="s.showAlert">
        <div class="alert-author-info">
            <span class="author"><strong>{{ s.alertNotesLabel }} by {{ s.comment.updatedBy.displayName }}</strong></span>
            <span class="date">{{s.comment.dateUpdated | amDateFormat:'MMMM Do, YYYY'}}</span>
        </div>
        <div class="alert-notes">
            <span ng-if="!s.alertNotes">No details available.</span>
            <span ng-if="s.alertNotes">{{ s.alertNotes }}</span>
            <span ng-if="s.alertReason">{{ s.alertReason }}</span>
        </div>
    </div><!-- / COMMENT NOTE ALERTS -->

    <!-- COMMENT INFO -->
    <section>
        <div class="comment-author-info">
            <span class="author"><strong>Posted by <span ng-if="!s.comment.isAnonymous && s.comment.author">{{ ::s.comment.author }}</span><span ng-if="s.comment.isAnonymous">Anonymous</span></strong></span>
            <span class="pull-right label {{ s.alertType }}" ng-if="s.alertType">{{ s.alertNotesLabel }} &nbsp;-&nbsp; by {{ s.comment.updatedBy.displayName }}</span>
            <span class="date">
                {{s.comment.dateAdded | amDateFormat:'MMMM Do, YYYY'}} <span ng-if="s.comment.location"> &nbsp;|&nbsp; {{ ::s.comment.location }}</span>
            </span>
        </div>
        <div class="comment-body panel panel-default" ng-if="s.comment.comment">
            <pre>{{ ::s.comment.comment }}</pre>
        </div>
    </section><!-- / COMMENT INFO -->

    <section class="comment-vcs">
        <div class="tag-list" ng-if="s.comment.pillars.length > 0">
            <span class="label label-default" ng-repeat="topic in s.comment.topics">{{topic}}</span>
        </div>
        <button class="btn btn-default btn-sm" type="button" ng-if="s.period.userCan.classifyComments" title="Assign Valued Components"
            x-vc-chooser
            x-project="s.project"
            x-current="s.comment.valuedComponents"
            x-topics="s.comment.topics"
            x-pillars="s.comment.pillars"><span class="glyphicon glyphicon-plus"></span><span>Assign Valued Components</span>
        </button>
    </section>

    <!-- ATTACHMENTS -->
    <section ng-if="s.comment.documents.length > 0">
        <label class="control-label"><span ng-if="s.period.userCan.vetComments">Review </span>Attachments</label>
        <ul class="comment-attachments list-group">
            <li class="list-group-item flex-row" ng-repeat="file in s.comment.documents">
              <div class="icon">
                    <span class="glyphicon glyphicon-file"></span>
                </div>
                <div class="title">{{ file.internalOriginalName }}</div>
                <div class="comment-review-btns" ng-if="s.period.userCan.vetComments">
                    <button class="reject-btn btn btn-default btn-sm" type="button" title="Reject attachment"
                        ng-class="{'active':file.eaoStatus === 'Rejected'}"
                        ng-click="s.fileStatusChange('Rejected', file)">Reject
                    </button>
                    <button class="publish-btn btn btn-default btn-sm" type="button" title="Publish attachment"
                        ng-class="{'active':file.eaoStatus === 'Published'}"
                        ng-click="s.fileStatusChange('Published', file)">Publish
                    </button>
                </div>
                <div class="actions">
                    <a class="btn btn-default btn-sm" ng-if="file._id" href="/api/document/{{ file._id }}/fetch" target="_blank" title="Download file">
                        <span class="glyphicon glyphicon-download-alt"></span>
                    </a>
                </div>
            </li>
        </ul>
    </section><!-- / ATTACHMENTS -->

    <!-- SET COMMENT STATUS -->
    <section class="eao-comment-review" ng-if="s.period.userCan.vetComments">
        <div class="form-group">
            <label class="control-label">Comment State</label>
            <div class="comment-review-btns">
                <button class="defer-btn btn btn-default" type="button" title="Defer comment"
                    ng-class="{'active':s.comment.eaoStatus === 'Deferred'}"
                    ng-click="s.statusChange('Deferred')">Defer
                </button>
                <button class="reject-btn btn btn-default" type="button" title="Reject comment"
                    ng-class="{'active':s.comment.eaoStatus === 'Rejected'}"
                    ng-click="s.statusChange('Rejected')">Reject
                </button>
                <button class="publish-btn btn btn-default" type="button" title="Publish comment"
                    ng-class="{'active':s.comment.eaoStatus === 'Published'}"
                    ng-click="s.statusChange('Published')">Publish
                </button>
            </div>
        </div>
        <div class="comment-status-note form-group" ng-class="{ 'has-error' : commentForm.eaoNotes.$invalid }" ng-if="s.comment.eaoStatus === 'Deferred'">
            <label class="control-label">Deferral Note<em>Required</em></label>
            <textarea class="form-control" name="eaoNotes" ng-model="s.comment.eaoNotes" rows="4" ng-required="s.comment.eaoStatus === 'Deferred'" ></textarea>
        </div>
        <div class="comment-status-note" ng-if="s.comment.eaoStatus === 'Rejected'">
            <div class="form-group" ng-class="{ 'has-error' : commentForm.rejectedReason.$invalid }">
                <label class="control-label">Reason for Rejection<em>Required</em></label>
                <select name="rejectedReason" ng-model="s.comment.rejectedReason" class="form-control" ng-required="s.comment.eaoStatus === 'Rejected'" ng-options="reason as reason for reason in s.rejectedReasons"></select>
            </div>
            <div class="form-group" ng-class="{ 'has-error' : commentForm.rejectedNotes.$invalid }">
                <label class="control-label">Rejection Note<em>Required</em></label>
                <textarea class="form-control" name="rejectedNotes" ng-model="s.comment.rejectedNotes" ng-required="s.comment.eaoStatus === 'Rejected'" rows="4"></textarea>
            </div>
        </div>
        <div class="comment-status-note form-group" ng-class="{ 'has-error' : commentForm.publishedNotes.$invalid }" ng-if="s.comment.eaoStatus === 'Published'">
          <label class="control-label">Notes<em>Optional</em></label>
          <textarea class="form-control" name="publishedNotes" ng-model="s.comment.publishedNotes" ng-required="false" rows="4"></textarea>
        </div>
    </section><!-- / SET COMMENT STATUS -->

</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="s.cancel()">{{ s.canUpdate ? 'Cancel' : 'Close' }}</button>
    <button type="submit" class="btn btn-success" ng-if="s.canUpdate" ng-disabled="!commentForm.$valid || s.comment.eaoStatus === 'Unvetted'">Update</button>
</div>

</form>
