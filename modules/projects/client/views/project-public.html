
<section id="project-view" class="row">

	<div class='col-sm-4'>
		<div class="panel panel-default project-info-panel">

			<div class="panel-header">
				<h1 class="panel-title">
					{{ vm.project.name }}<br/>Public Comment Period
				</h1>
			</div>

			<div class='panel-body'>

				<div><label class="control-label">Location</label><p>{{ vm.project.location }}</p></div>
				<div ng-init="toggleProject.desc = (false)"><label class="control-label">Description</label>
					<p>{{ vm.project.description | maxWords:5:toggleProject.desc }}<br/>
					<span class="small" ng-if="(vm.project.description | wordCount) > 5">
						<a href ng-click="toggleProject.desc = !toggleProject.desc">
							<span ng-show="!toggleProject.desc"><em>More ({{ vm.project.description | wordCount }} words)</em></span>
							<span ng-show="toggleProject.desc"><em>Less</em></span>
						</a>
					</span>
					</p>
				</div>

				<div ng-if="(vm.project.dateCommentsOpen && vm.project.dateCommentsClosed)">
					<label class="control-label">Public Comment Period</label>
					<p>
						{{ vm.project.dateCommentsOpen | amDateFormat:'MMM Do, YYYY'}} to {{ vm.project.dateCommentsClosed | amDateFormat:'MMM Do, YYYY' }}
						<span ng-if="(vm.project.dateCommentsOpen | isInThePast) && (vm.project.dateCommentsClosed | isInTheFuture)"><br/><strong><em>Open Now</em></strong></span>
					</p>
				</div>

				<div class="form-group" ng-if="(vm.project.dateCommentsOpen | isInThePast) && ((vm.project.dateCommentsClosed | isInTheFuture) || vm.isLoggedInUser)">
					<a class="btn btn-block btn-success wrap btn-md" href x-modal-add-public-comment x-project="vm.project">Click here to Comment on the Application</a>
				</div>
			</div>

			<div ng-init="toggleProject.docs = false">
				<h3 class="panel-sub-title clickable panel-body" ng-click="toggleProject.docs = !toggleProject.docs">Application Main Report</h3>
			</div>

			<div class='panel-body'>
				<ul class="small list-unstyled list-documents" ng-show="toggleProject.docs">

					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453141986150_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Cover and Citation</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142022345_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Table of Contents</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142052772_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Preface</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142119132_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Executive Summary</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453149356765_zf12WdTTG282vq7w8GSPhm1NQZ6PQlpmjMdh3TyZl1pZPVh8S88c!1143392206!1453134739726.pdf"><span class="glyphicon glyphicon-file"></span> Resume (En Francais)</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142293042_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Acknowledgements</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142385497_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Table of Concordance</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142456114_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Table of Contents</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142494856_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Acronyms Abbreviations</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142535144_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Glossary</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453142701405_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch01_Purpose of Application Environmental Impact Statement</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453143417569_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch02_Project Overview</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453143544288_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch03_Detailed Project Description</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453143580190_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch04_Assessment Process</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453143649333_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch05_Effects Assessment Methodology</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453143765260_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch06_Assessment of Potential Environmental Effects - Part 1</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453308398077_v5m1WfwCZ9hq9JT5QQy4H9SghRskvTxtH6STQTGHmpLG4g6ZC2xT!-2016153214!1453305954585.pdf"><span class="glyphicon glyphicon-file"></span> Ch06_Assessment of Potential Environmental Effects - Part 2</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453144301758_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch07_Assessment of Potential Economic Effects</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453144410413_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch08_Assessment of Potential Social Effects</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453144922246_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch09_Assessment of Potential Heritage Effects</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453145022237_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch10_Assessment of Potential Health Effects</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453145225441_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch11_Summary of Proposed Environmental and Operational Management Plans</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453145809918_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch12_Background and Aboriginal Groups Settings</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453158457270_zf12WdTTG282vq7w8GSPhm1NQZ6PQlpmjMdh3TyZl1pZPVh8S88c!1143392206!1453134739726.pdf"><span class="glyphicon glyphicon-file"></span> Ch13_Aboriginal Interests Rights and Title</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453145943264_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch14_Other Potential Effects on Aboriginal Interests</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453146020839_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch15_Procedural Aspects of Aboriginal Consultation</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453146075277_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch16_Summary Aboriginal Interests</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453146159939_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch17_Federal Environmental Assessment Requirements</a></li>
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/documents/p362/d39700/1453146217337_QzJ9WdsMpRJvp1GtL2JJmYjYw0jptTxFgrx6SyVKDJxRgQFvZ9Jq!1143392206!1453141196524.pdf"><span class="glyphicon glyphicon-file"></span> Ch18_Summary and Conclusions</a></li>
				</ul>

				<ul class="small list-unstyled list-documents" ng-show="toggleProject.docs">
					<li><a href ng-click="toggleProject.docs = !toggleProject.docs"><em>Hide Application Files</em></a></li>
				</ul>
				<ul class="small list-unstyled list-documents" ng-show="!toggleProject.docs">
					<li><a href ng-click="toggleProject.docs = !toggleProject.docs"><em>View Application Files</em></a></li>
				</ul>
			</div>

			<div>
				<h3 class="panel-sub-title panel-body">Application Appendices</h3>
			</div>

			<div class='panel-body'>
				<ul class="small list-unstyled list-documents">
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/html/deploy/epic_project_doc_list_362_r_app.html">View Appendices [opens in new window]</a></li>
				</ul>
			</div>

			<div>
				<h3 class="panel-sub-title panel-body">All Other Documents</h3>
			</div>

			<div class='panel-body'>
				<ul class="small list-unstyled list-documents">
					<li><a target="_new" href="http://a100.gov.bc.ca/appsdata/epic/html/deploy/epic_project_home_362.html">View Documents [opens in new window]</a></li>
				</ul>
			</div>

			<div class="location-map">
				<map center="{{ vm.project.lat }},{{ vm.project.lon }}" zoom="10" map-type-id="ROADMAP" street-view-control='false' min-zoom=10 max-zoom=10 disable-default-u-i="true">
					<kml-layer url="{{ vm.host }}/map_layers/Ajax_2016Jan7data_Footprint_25Buffer_filled.kml"></kml-layer>
				</map>
			</div>

		</div>
	</div>

	<div class='col-sm-8'>

		<div class="alert alert-info text-center" ng-if="vm.project.dateCommentsOpen | isInTheFuture">
			<div>
				<p>Public Comment Period Scheduled for <strong>{{ ::vm.project.dateCommentsOpen | amDateFormat:'MMM Do, YYYY'}}</strong> to <strong>{{ ::vm.project.dateCommentsClosed | amDateFormat:'MMM Do, YYYY'}}</strong></p>
				<countdown-clock x-end="vm.project.dateCommentsOpen"></countdown-clock>
			</div>
		</div>


		<div class="panel panel-default panel-concern">

			<div class="panel-body">
				<div class="small form-group">

					<h3>Submitting Your Comments: How It Works</h3>
					<p>Comments submitted to the Environmental Assessment Office (EAO) will be published online.</p>
					<p>EAO publishes all accepted comments within seven days of receipt. Comments are not accepted if - in EAO’s view - they are profane, abusive or do not relate to the matter being consulted upon as stated in our <a href="http://www.eao.gov.bc.ca/pdf/EAO_Policy_Public_Comment.pdf" target="_new">Public Comment Policy [PDF]</a>.</p>
					<p ng-show="!legalMore"><a href ng-click="legalMore = true"><em>More...</em></a></p>
					<p ng-show="legalMore">EAO forwards all posted comments to project proponents so that they can be duly considered during the project's Environmental Assessment (EA) process.</p>
					<p ng-show="legalMore">You may provide your name and city/town when making a comment, but in order to have your name displayed with your comment you must select the 'Show my name and location on the public site' option.</p>
					<p ng-show="legalMore">All hyperlinks in comments will be converted to plain text. All attachments must be in PDF format and limited to 5MB.</p>
					<p ng-show="legalMore"><a href ng-click="legalMore = false"><em>Less</em></a></p>

					<hr>
					<p><em>Public comments received by EAO are published according to the date received.  Where relevant, comments may be categorized by one or more topic areas from the Application, either during or following the public comment period.  Categorized comments will appear by topic area below.</em></p>

				</div>

				<div ng-if="vm.comments.length !== 0 && (vm.project.dateCommentsOpen | isInThePast) ">

					<nav class="navbar navbar-default navbar-sm" ng-init="vm.form.view = 'bydate'" ng-if="vm.comments.length !== 0">
						<div class="container-fluid">

							<ul class="nav navbar-nav navbar-form navbar-left">
								<li>
									<div class="btn-group btn-group-sm">
										<button ng-if="vm.readyByDate"  class="btn btn-default" ng-click="vm.form.view = 'bydate'"	ng-class="{'btn-primary': vm.form.view === 'bydate'}">By Date</button>
										<button ng-if="vm.readyByTopic" class="btn btn-default" ng-click="vm.form.view = 'bytopic'"	ng-class="{'btn-primary': vm.form.view === 'bytopic'}">By Topic</button>
										<button ng-if="vm.readyByChart" class="btn btn-default" ng-click="vm.form.view = 'bychart'"	ng-if="vm.commentsByTopicVis" ng-class="{'btn-primary': vm.form.view === 'bychart'}">By Topic Chart</button>
									</div>
									<button ng-if="vm.enableGetMore" class="btn btn-sm btn-default" ng-click="vm.getAllComments()">Load All Comments</button>
								</li>
							</ul>

							<ul class="nav navbar-nav navbar-right">

								<li ng-if="vm.form.view !== 'bychart'">
									<form class="navbar-form" role="filter1">
										<div class="form-group">
											<label class="control-label">Keyword Search</label>
											<input ng-model="vm.filterKeyword" ng-model-options="{ updateOn: 'blur' }" type="text" class="form-control" placeholder="">
										</div>
									</form>
								</li>
							</ul>

						</div><!-- /.container-fluid -->
					</nav>
				</div>


				<div ng-repeat="(heading, topic) in vm.commentsByTopicKeys | orderBy:'name' | filter:vm.filterBucketGroup track by $index" class="concern-list" ng-show="vm.form.view === 'bytopic' && vm.comments.length > 0" ng-init="toggleTopicComment[item._id] = false">
					<h3 ng-click='form[heading] = !form[heading]' class="clickable concern-heading">
						{{ ::heading }}<div class="pull-right small"><span ng-if="!form[heading]">Click to view.</span> Number of comments tagged: {{ (vm.commentsByTopic[heading] | filter:vm.filterKeyword).length || 0 }} of {{ vm.comments.length || 0 }} </div>
					</h3>
					<hr ng-if='!form[heading]'>
					<div class="" ng-show='form[heading]'>
						<div class="row comment-list" ng-repeat-start="item in vm.commentsByTopic[heading] | advancedFilter:vm.filterKeyword | orderBy:'dateAdded':true track by item._id">
							<div class="col-sm-9" ng-init="toggleTopicComment[item._id] = false">
								<pre ng-show="!toggleTopicComment[item._id]" class="form-group">{{ ::item.comment | maxWords:80:false }}</pre>
								<pre ng-show="toggleTopicComment[item._id]" class="form-group">{{ ::item.comment }}</pre>
								<p ng-if="(item.comment | wordCount) > 80">
									<a href ng-click="toggleTopicComment[item._id] = !toggleTopicComment[item._id]">
										<span ng-show="!toggleTopicComment[item._id]"><em>More ({{ ::item.comment | wordCount }} words)</em></span>
										<span ng-show="toggleTopicComment[item._id]"><em>Less</em></span>
									</a>
								</p>
							</div>


							<div class="col-sm-3">
								<p ng-if="item.author && item.displayName">Name: {{ ::item.author }}</p>
								<p ng-if="item.location && item.displayName">Location: {{ ::item.location }}</p>
								<p>{{ ::item.dateAdded | amDateFormat:'MMM Do, YYYY h:mm a'}}</p>
								<ul class="list-unstyled document-vetting small">
									<li ng-repeat="doc in ::item.documents track by doc._id">
										<a href="/api/commentdocument/{{ doc._id }}/fetch" target="_blank" class="small" ng-if="doc.eaoStatus == 'Published'"><span class="glyphicon glyphicon-file"></span> {{ ::doc.name }}</a>
									</li>
								</ul>

								<div class="form-group" ng-show="item.buckets.length > 0">
									<label class="control-label">Related Topics</label>
									<ul class="small">
										<li ng-repeat="bucket in ::item.buckets track by $index">{{ bucket.name }}</li>
									</ul>
								</div>

							</div>



						</div>
						<hr ng-repeat-end>
					</div>


					<div ng-show='( buckets | advancedFilter:vm.filterKeyword).length === 0 && form[heading]'>
						<div class="panel-body">
							No comments match these keywords.
						</div>
					</div>
				</div>

<!-- 				<div ng-show="!vm.commentsByTopic && vm.form.view === 'bytopic'">
					<div class="panel-body">
						No comments have been classified by topic yet.  Please check back later.
					</div>
				</div> -->


				<div ng-show="vm.form.view === 'bydate' && vm.comments.length > 0">
					<div class="panel-body">
						<div class="row comment-list" ng-repeat-start="item in commentsFiltered = (vm.comments | advancedFilter:vm.filterKeyword) | orderBy:'dateAdded':true track by item._id">

							<div class="col-sm-9" ng-init="toggleDateComment[item._id] = false">
								<pre ng-show="!toggleDateComment[item._id]" class="form-group">{{ ::item.comment | maxWords:80:false }}</pre>
								<pre ng-show="toggleDateComment[item._id]" class="form-group ng-hide ">{{ ::item.comment }}</pre>
								<p ng-if="(item.comment | wordCount) > 80">
									<a href  ng-click="toggleDateComment[item._id] = !toggleDateComment[item._id]">
										<span ng-show="!toggleDateComment[item._id]"><em>More ({{ ::item.comment | wordCount }} words)</em></span>
										<span ng-show="toggleDateComment[item._id]"><em>Less</em></span>
									</a>
								</p>
							</div>

							<div class="col-sm-3">
								<p ng-if="item.author && item.displayName">Name: {{ ::item.author }}</p>
								<p ng-if="item.location && item.displayName">Location: {{ ::item.location }}</p>
								<p>{{ ::item.dateAdded | amDateFormat:'MMM Do, YYYY h:mm a'}}</p>
								<ul class="list-unstyled document-vetting small">
									<li ng-repeat="doc in ::item.documents track by doc._id">
										<a href="/api/commentdocument/{{ doc._id }}/fetch" target="_blank" class="small" ng-if="doc.eaoStatus === 'Published'"><span class="glyphicon glyphicon-file"></span> {{ doc.name }}</a>
									</li>
								</ul>

								<div class="form-group" ng-show="item.buckets.length > 0">
									<label class="control-label">Related Topics</label>
									<ul class="small">
										<li ng-repeat="bucket in ::item.buckets track by $index">{{ bucket.name }}</li>
									</ul>
								</div>

							</div>


						</div>
						<hr ng-if="!$last" ng-repeat-end>

						<div ng-if="commentsFiltered.length === 0 && vm.form.view === 'bydate' && vm.filterKeyword">
							No comments match those keywords.
						</div>

					</div>
				</div>



				<div class="" ng-show="vm.form.view === 'bychart' && vm.comments.length > 0">
					<div class="panel-body">
						<label class="control-label">Comment Volume by Topic</label>
						<tmpl-public-project-comments-circle-chart ng-if="vm.commentsByTopicVis" x-refresh="vm.refreshVisualization" x-data="::vm.commentsByTopicVis" id="publicCommentsByTopic"></tmpl-public-project-comments-circle-chart>
					</div>
				</div>

				<div ng-show="vm.comments.length === 0">
					<hr>
					There are no comments on this project.
				</div>

				<a href ng-if="vm.enableGetMore" class="btn-link btn btn-block text-center" ng-click="vm.getAllComments()">Latest 20 Comments showing.  Click here to load all Comments</a>

			</div>
		</div>




	</div>

</section>
