
<section id="project-view" class="row">

	<div class='col-sm-4'>
		<div class="panel panel-default project-info-panel">

			<div class="panel-header">
				<h1 class="panel-title">
					{{ vm.project.name }}<br/>Public Comment Period
				</h1>
			</div>

			<div class='panel-body'>

				<div><label class="control-label">Location</label><p>{{ vm.project.location }}</p></div>
				<div><label class="control-label">Region</label><p>{{ vm.project.region | regionName }}</p></div>
				<div><label class="control-label">Description</label><p>{{ vm.project.description }}</p></div>

				<div ng-if="(vm.project.dateCommentsOpen && vm.project.dateCommentsClosed)">
					<label class="control-label">Public Comment Period</label>
					<p>
						{{ vm.project.dateCommentsOpen | amDateFormat:'MMM Do, YYYY'}} to {{ vm.project.dateCommentsClosed | amDateFormat:'MMM Do, YYYY' }}
						<span ng-if="(vm.project.dateCommentsOpen | isInThePast) && (vm.project.dateCommentsClosed | isInTheFuture)"><br/><strong><em>Open Now</em></strong></span>
					</p>

				</div>

				<div class="form-group" ng-if="(vm.project.dateCommentsOpen | isInThePast) && (vm.project.dateCommentsClosed | isInTheFuture)">
					<a class="btn btn-block btn-success wrap btn-md" href x-modal-add-public-comment x-project="vm.project">Click here to Comment on the Application</a>
				</div>

				<div>
					<label class="control-label">Documents</label>
					<p class="small">
						<a href><span class='glyphicon glyphicon-file'></span> Application</a>
					</p>
				</div>


			</div>

			<div class="location-map">
				<map center="{{ vm.project.lat }},{{ vm.project.lon }}" zoom="5" map-type-id="SATELLITE" street-view-control='false' min-zoom=5 disable-default-u-i="true">
					<marker id="marker_{{ vm.project._id }}" position="{{ vm.project.lat }},{{ vm.project.lon }}"></marker>
				</map>
			</div>
			
			<div class='panel-body' ng-show="vm.commentsByDateVis">
				<label class="control-label">Comment Volume by Date</label>
				<tmpl-public-project-comments-circle-chart ng-if="vm.commentsByDateVis" x-refresh="vm.refreshVisualization" x-data="vm.commentsByDateVis" id="publicCommentsByDate"></tmpl-public-project-comments-circle-chart>
			</div>

		</div>
	</div>

	<div class='col-sm-8'>

		<div class="alert alert-info text-center" ng-if="vm.project.dateCommentsOpen | isInTheFuture">
			<div>
				<p>Public Comment Period Scheduled for <strong>{{ vm.project.dateCommentsOpen | amDateFormat:'MMM Do, YYYY'}}</strong> to <strong>{{ vm.project.dateCommentsClosed | amDateFormat:'MMM Do, YYYY'}}</strong></p>
				<countdown-clock x-end="vm.project.dateCommentsOpen"></countdown-clock>
			</div>
		</div>


		<div class="panel panel-default panel-concern">

			<div class="panel-body">
				<div class="small form-group">

					<h3>Submitting Your Comments: How It Works</h3>

					<p>Comments submitted to the Environmental Assessment Office (EAO), either online, by mail or by fax, will be published on the <a href="http://a100.gov.bc.ca/appsdata/epic/html/deploy/epic_home.html" target="_new">EAO Electronic Project Information Centre (ePIC)</a>.</p>

					<p>EAO publishes all comments received within seven days of receipt, except comments that EAO deems to be inappropriate for publication. Comments may be considered inappropriate for publication if - in EAOâ€™s view - they are profane, abusive or do not relate to the matter being consulted upon as stated in our <a href="http://www.eao.gov.bc.ca/pdf/EAO_Policy_Public_Comment.pdf" target="_new">Public Comment Policy [PDF]</a>.</p>

					<p ng-show="!legalMore"><a href ng-click="legalMore = true">More...</a></p>

					<p ng-show="legalMore">EAO forwards all posted comments to project proponents so that they can be duly considered during the project's Environmental Assessment (EA) process.</p>

					<p ng-show="legalMore">Although you may provide your name and city/town when making a comment, in order to have your name displayed with your comment you must select the 'Show my name and location on the public site' option.</p>

					<p ng-show="legalMore">All links/URLs in a comment will be removed as we cannot guarantee that the link will not break during the time the comment is publicly available in the EAO Project Information Centre. To include content from another web site, please attach it as a PDF to your comment.</p>
					<p ng-show="legalMore"><a href ng-click="legalMore = false">Less</a></p>
				</div>

				<div ng-if="vm.comments.length !== 0 && (vm.project.dateCommentsOpen | isInThePast) && (vm.project.dateCommentsClosed | isInTheFuture)">
					<nav class="navbar navbar-default navbar-sm" ng-init="vm.form.view = 'bydate'" ng-if="vm.comments.length !== 0">
						<div class="container-fluid">

							<ul class="nav navbar-nav navbar-form navbar-left">
								<li>
									<div class="btn-group btn-group-sm">
										<button class="btn btn-default" ng-click="vm.form.view = 'bydate'"	ng-class="{'btn-primary': vm.form.view === 'bydate'}">By Date</button>
										<button class="btn btn-default" ng-click="vm.form.view = 'bytopic'"	ng-class="{'btn-primary': vm.form.view === 'bytopic'}">By Topic</button>
										<button class="btn btn-default" ng-click="vm.form.view = 'bychart'"	ng-if="vm.commentsByTopicVis" ng-class="{'btn-primary': vm.form.view === 'bychart'}">By Topic Chart</button>
									</div>

								</li>
							</ul>

							<ul class="nav navbar-nav navbar-right">

								<li ng-if="vm.form.view !== 'bychart'">
									<form class="navbar-form" role="filter1">
										<div class="form-group">
											<label class="control-label">Keyword Search</label>
											<input ng-model="vm.filterKeyword" type="text" class="form-control" placeholder="">
										</div>
									</form>
								</li>
							</ul>

						</div><!-- /.container-fluid -->
					</nav>
				</div>


				<div ng-repeat="(heading, topic) in vm.commentsByTopicKeys | orderBy:'name' | filter:vm.filterBucketGroup" class="concern-list" ng-show="vm.form.view === 'bytopic' && vm.comments.length > 0" ng-init="toggleTopicComment[item._id] = false">
					<h3 ng-click='form[heading] = !form[heading]' class="clickable concern-heading">
						{{ heading }}<div class="pull-right small"><span ng-if="!form[heading]">Click to view.</span> Number of comments: {{ (vm.commentsByTopic[heading] | filter:vm.filterKeyword).length || 0 }}</div>
					</h3>
					<hr ng-if='!form[heading]'>
					<div class="" ng-show='form[heading]'>
							<div class="row comment-list" ng-repeat-start="item in vm.commentsByTopic[heading] | advancedFilter:vm.filterKeyword | orderBy:'dateAdded':true">
								<div class="col-sm-9">
									<pre class="form-group">{{ item.comment | max80Words:toggleTopicComment[item._id] }}</pre>
									<p ng-if="(item.comment | wordCount) > 80">
										<a href ng-click="toggleTopicComment[item._id] = !toggleTopicComment[item._id]">
											<span ng-show="!toggleTopicComment[item._id]">More ({{ item.comment | wordCount }} words)</span>
											<span ng-show="toggleTopicComment[item._id]">Less</span>										
										</a>
									</p>
								</div>


								<div class="col-sm-3">
									<p ng-if="item.author && item.displayName">Name: {{ item.author }}</p>
									<p ng-if="item.location && item.displayName">Location: {{ item.location }}</p>								
									<p>{{ item.dateAdded | amDateFormat:'MMM Do, YYYY h:mm a'}}</p>
									<ul class="list-unstyled document-vetting small">
										<li ng-repeat="doc in item.documents">
											<a href="/api/commentdocument/{{ doc._id }}/fetch" target="_blank" class="small" ng-if="doc.eaoStatus == 'Published'"><span class="glyphicon glyphicon-file"></span> {{ doc.name }}</a>
										</li>
									</ul>
	
									<div class="form-group" ng-show="item.buckets.length > 0">
										<label class="control-label">Related Topics</label>
										<ul class="small">
											<li ng-repeat="bucket in item.buckets">{{ bucket.name }}</li>
										</ul>
									</div>

								</div>



							</div>
							<hr ng-repeat-end>
					</div>


					<div ng-show='( buckets | advancedFilter:vm.filterKeyword).length === 0 && form[heading]'>
						<div class="panel-body">
							No comments match these keywords.
						</div>
					</div>
				</div>

				<div ng-show="!vm.commentsByTopic && vm.form.view === 'bytopic'">
					<div class="panel-body">
						No comments have been classified by topic yet.  Please check back later.
					</div>
				</div>


				<div ng-show="vm.form.view === 'bydate' && vm.comments.length > 0">
					<div class="panel-body">
						<div class="row comment-list" ng-repeat-start="item in commentsFiltered = (vm.comments | advancedFilter:vm.filterKeyword) | orderBy:'dateAdded':true" ng-init="toggleDateComment[item._id] = false">

							<div class="col-sm-9">
								<pre class="form-group">{{ item.comment | max80Words:toggleDateComment[item._id] }}</pre>
								<p ng-if="(item.comment | wordCount) > 80">
									<a href  ng-click="toggleDateComment[item._id] = !toggleDateComment[item._id]">
										<span ng-show="!toggleDateComment[item._id]">More ({{ item.comment | wordCount }} words)</span>
										<span ng-show="toggleDateComment[item._id]">Less</span>										
									</a>
								</p>
							</div>

							<div class="col-sm-3">
								<p ng-if="item.author && item.displayName">Name: {{ item.author }}</p>
								<p ng-if="item.location && item.displayName">Location: {{ item.location }}</p>
								<p>{{ item.dateAdded | amDateFormat:'MMM Do, YYYY h:mm a'}}</p>
								<ul class="list-unstyled document-vetting small">
									<li ng-repeat="doc in item.documents">
										<a href="/api/commentdocument/{{ doc._id }}/fetch" target="_blank" class="small" ng-if="doc.eaoStatus === 'Published'"><span class="glyphicon glyphicon-file"></span> {{ doc.name }}</a>
									</li>
								</ul>

								<div class="form-group" ng-show="item.buckets.length > 0">
									<label class="control-label">Related Topics</label>
									<ul class="small">
										<li ng-repeat="bucket in item.buckets">{{ bucket.name }}</li>
									</ul>
								</div>

							</div>


						</div>
						<hr ng-if="!$last" ng-repeat-end>

						<div ng-if="commentsFiltered.length === 0 && vm.form.view === 'bydate' && vm.filterKeyword">
							No comments match those keywords.
						</div>

					</div>
				</div>

			

				<div class="" ng-show="vm.form.view === 'bychart' && vm.comments.length > 0">
					<div class="panel-body">
						<label class="control-label">Comment Volume by Topic</label>
						<tmpl-public-project-comments-circle-chart ng-if="vm.commentsByTopicVis" x-refresh="vm.refreshVisualization" x-data="vm.commentsByTopicVis" id="publicCommentsByTopic"></tmpl-public-project-comments-circle-chart>
					</div>
				</div>

				<div ng-show="vm.comments.length === 0">
					<hr>
					There are no comments on this project.						
				</div>

			</div>
		</div>




	</div>

</section>